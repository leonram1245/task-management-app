- name: ğŸ“¤ Upload backend code to EC2 via rsync
  run: |
    echo "ğŸ” Writing EC2 SSH private key to ~/.ssh/id_rsa..."
    mkdir -p ~/.ssh
    echo "${{ secrets.EC2_SSH_KEY }}" > ~/.ssh/id_rsa
    chmod 600 ~/.ssh/id_rsa
    echo "âœ… SSH key written."

    echo "ğŸ“ Current working directory:"
    pwd

    echo "ğŸ“‚ Listing files in root:"
    ls -al

    echo "ğŸ“‚ Changing into ./backend directory..."
    cd backend || { echo "âŒ backend directory not found"; exit 1; }

    echo "ğŸ“ Now in directory:"
    pwd

    echo "ğŸ“‚ Listing backend directory contents:"
    ls -al

    echo "ğŸ“¡ Running rsync to EC2..."
    rsync -avz --exclude 'node_modules' --exclude '.git' --exclude '.env' \
      -e "ssh -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa" \
      . ubuntu@${{ secrets.EC2_HOST }}:~/app || { echo "âŒ rsync failed"; exit 1; }

    echo "âœ… rsync upload complete."
